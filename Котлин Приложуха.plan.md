<!-- 1bd712af-a8e4-42bf-8bea-d7ee8a881ac4 44ebc582-172a-4e7c-91b6-045c401ea263 -->
# ТЗ: Мобильное приложение "Биржа раритетного мерча" (Android/Kotlin)

## Общее описание

Мобильное приложение для торговли редким коллекционным мерчем с тремя основными механиками: аукционы, лотереи и конкурсы. Приложение предназначено для начинающих Android-разработчиков и использует традиционный подход с XML Layouts и Fragments.

## Технологический стек

### Основные технологии

- **Язык**: Kotlin 1.9+
- **Минимальная версия Android**: API 24 (Android 7.0)
- **Целевая версия**: API 34 (Android 14)
- **Архитектура**: Clean Architecture + MVVM
- **Dependency Injection**: Hilt (упрощённая версия Dagger)

### Библиотеки

- **UI**: XML Layouts + ViewBinding + Material Components
- **Навигация**: Navigation Component (Fragments)
- **Сеть**: Retrofit 2 + OkHttp
- **Сериализация**: Kotlinx Serialization (или Gson)
- **Асинхронность**: Kotlin Coroutines + Flow
- **Изображения**: Glide (для загрузки фото товаров)
- **Локальная БД**: Room (для кэширования)
- **Время**: Kotlinx DateTime
- **RecyclerView**: DiffUtil для оптимизации списков

### Дополнительные инструменты

- **Логирование**: Timber
- **Отладка сети**: Chuck (HTTP Inspector)
- **Тестирование**: JUnit 4, MockK, Turbine (для Flow)
- **View Binding**: Включён по умолчанию

## Архитектура приложения

### Структура проекта

```
rare-merch-android/
├── app/
│   └── src/
│       └── main/
│           ├── java/com/example/raremerch/
│           │   ├── di/                    # Hilt модули
│           │   │   ├── AppModule.kt
│           │   │   ├── NetworkModule.kt
│           │   │   └── DatabaseModule.kt
│           │   ├── data/                  # Слой данных
│           │   │   ├── remote/            # API
│           │   │   │   ├── api/
│           │   │   │   │   ├── AuctionApi.kt
│           │   │   │   │   ├── LotteryApi.kt
│           │   │   │   │   └── AuthApi.kt
│           │   │   │   ├── dto/           # Data Transfer Objects
│           │   │   │   └── interceptor/   # HTTP перехватчики
│           │   │   ├── local/             # Room БД
│           │   │   │   ├── dao/
│           │   │   │   ├── entity/
│           │   │   │   └── AppDatabase.kt
│           │   │   └── repository/        # Реализация репозиториев
│           │   │       ├── AuctionRepositoryImpl.kt
│           │   │       └── LotteryRepositoryImpl.kt
│           │   ├── domain/                # Бизнес-логика
│           │   │   ├── model/             # Доменные модели
│           │   │   │   ├── Auction.kt
│           │   │   │   ├── Item.kt
│           │   │   │   ├── Lottery.kt
│           │   │   │   ├── User.kt
│           │   │   │   └── Bid.kt
│           │   │   ├── repository/        # Интерфейсы репозиториев
│           │   │   └── usecase/           # Use Cases
│           │   │       ├── auction/
│           │   │       │   ├── GetAuctionsUseCase.kt
│           │   │       │   └── PlaceBidUseCase.kt
│           │   │       └── lottery/
│           │   │           ├── GetLotteriesUseCase.kt
│           │   │           └── BuyTicketUseCase.kt
│           │   └── presentation/          # UI слой
│           │       ├── navigation/        # Навигация
│           │       ├── theme/             # Material Theme
│           │       ├── components/        # Переиспользуемые UI компоненты
│           │       ├── screens/           # Экраны (Fragments)
│           │       │   ├── auth/
│           │       │   │   ├── LoginFragment.kt
│           │       │   │   ├── LoginViewModel.kt
│           │       │   │   └── fragment_login.xml
│           │       │   ├── auctions/
│           │       │   │   ├── AuctionListFragment.kt
│           │       │   │   ├── AuctionListViewModel.kt
│           │       │   │   ├── AuctionDetailFragment.kt
│           │       │   │   ├── AuctionDetailViewModel.kt
│           │       │   │   ├── fragment_auction_list.xml
│           │       │   │   ├── fragment_auction_detail.xml
│           │       │   │   └── item_auction.xml
│           │       │   ├── lotteries/
│           │       │   │   ├── LotteryListFragment.kt
│           │       │   │   ├── LotteryListViewModel.kt
│           │       │   │   ├── LotteryDetailFragment.kt
│           │       │   │   ├── LotteryDetailViewModel.kt
│           │       │   │   ├── fragment_lottery_list.xml
│           │       │   │   ├── fragment_lottery_detail.xml
│           │       │   │   └── item_lottery.xml
│           │       │   └── profile/
│           │       │       ├── ProfileFragment.kt
│           │       │       ├── ProfileViewModel.kt
│           │       │       └── fragment_profile.xml
│           │       └── MainActivity.kt
│           └── res/                       # Ресурсы
│               ├── drawable/              # Иконки, изображения
│               ├── values/                # Строки, цвета, стили
│               ├── layout/                # XML макеты
│               └── xml/                   # Конфигурации
└── build.gradle.kts
```

### Слои архитектуры

#### 1. Presentation Layer (UI)

- **XML Layouts + ViewBinding** для построения UI
- **Fragments** для экранов
- **ViewModel** для управления состоянием
- **StateFlow/SharedFlow** для реактивного обновления UI
- **RecyclerView + Adapter** для списков
- Обработка UI событий через sealed class

#### 2. Domain Layer (Бизнес-логика)

- Чистые Kotlin классы без Android зависимостей
- Use Cases - один класс = одно действие
- Доменные модели
- Интерфейсы репозиториев

#### 3. Data Layer (Данные)

- Реализация репозиториев
- API клиенты (Retrofit)
- Локальная БД (Room)
- Маппинг DTO ↔ Domain Models

## Функциональные требования

### MVP (Минимально жизнеспособный продукт)

#### 1. Аутентификация

- Экран входа (email + пароль)
- Экран регистрации
- Хранение JWT токена в SharedPreferences (зашифрованно)
- Автоматический вход при наличии токена

#### 2. Главный экран (Bottom Navigation)

- **Аукционы** - список активных аукционов
- **Лотереи** - список доступных лотерей
- **Профиль** - информация о пользователе

#### 3. Экран списка аукционов

**Обязательные элементы:**

- RecyclerView с карточками аукционов:
  - Фото товара (ImageView)
  - Название (TextView)
  - Текущая цена (TextView)
  - Время до окончания (таймер)
  - Количество ставок (TextView)
- SwipeRefreshLayout для обновления
- Фильтры: категория, ценовой диапазон
- Сортировка: по времени окончания, по цене
- ProgressBar для загрузки

**Состояния:**

- Loading (ProgressBar)
- Success (RecyclerView с данными)
- Error (TextView с сообщением + кнопка повтора)
- Empty (TextView "Список пуст")

#### 4. Экран детальной информации об аукционе

**Обязательные элементы:**

- ViewPager2 для галереи фото товара
- TextView с полным описанием
- TextView с текущей ценой (обновляется в реальном времени)
- RecyclerView с историей последних 10 ставок
- TextView с таймером до окончания
- Button "Сделать ставку"
- CardView с информацией о продавце (рейтинг, имя)

**Функционал ставок:**

- AlertDialog для ввода суммы ставки
- Валидация минимального шага
- Подтверждение ставки
- Toast уведомления об успехе/ошибке

#### 5. Экран списка лотерей

**Обязательные элементы:**

- RecyclerView с карточками лотерей:
  - Фото приза (ImageView)
  - Название (TextView)
  - Цена билета (TextView)
  - ProgressBar (проданные/всего билетов)
  - TextView с временем розыгрыша
- Фильтр по статусу (активные/завершённые)

#### 6. Экран детальной информации о лотерее

**Обязательные элементы:**

- ImageView с фото приза
- TextView с описанием
- TextView с ценой билета
- TextView с количеством доступных билетов
- TextView с временем розыгрыша
- Button "Купить билеты"
- RecyclerView со списком купленных билетов пользователя
- TextView с информацией о честности розыгрыша (server_seed hash)

**Функционал покупки:**

- AlertDialog для выбора количества билетов (1-10)
- TextView с расчётом итоговой стоимости
- Подтверждение покупки
- Отображение номеров купленных билетов

#### 7. Экран профиля

**Обязательные элементы:**

- CircleImageView с аватаром пользователя
- TextView с именем пользователя
- TextView с рейтингом и рангом
- TextView с балансом (для будущей интеграции платежей)
- RecyclerView с историей участия:
  - Мои ставки
  - Мои билеты
  - Выигранные лоты
- Button выхода

### Дополнительные фичи (Phase 2)

- Push-уведомления (Firebase Cloud Messaging)
- WebSocket для real-time обновлений ставок
- Автоматические ставки
- Конкурсы
- Создание аукционов

## Нефункциональные требования

### Производительность

- Время запуска приложения: < 2 секунды
- Плавная прокрутка списков (60 FPS)
- Кэширование изображений с Glide
- Offline-режим: отображение закэшированных данных

### Безопасность

- Хранение токенов в EncryptedSharedPreferences
- HTTPS для всех запросов
- Обфускация кода (ProGuard/R8)
- Валидация ввода на клиенте

### UX/UI

- Material Design 3
- Тёмная и светлая темы
- Адаптивная вёрстка (поддержка планшетов)
- Анимации переходов между экранами
- Skeleton loading для улучшения восприятия загрузки

### Обработка ошибок

- Graceful degradation при отсутствии сети
- Понятные сообщения об ошибках на русском языке
- Retry механизм для сетевых запросов
- Логирование ошибок (Crashlytics в будущем)

## API интеграция

### Base URL

```
https://api.raremerch.com/api/v1
```

### Основные endpoints для MVP

#### Аутентификация

```
POST /auth/register
POST /auth/login
GET /users/me
```

#### Аукционы

```
GET /auctions?page=1&limit=20&category=sneakers&sort=ending_soon
GET /auctions/:id
POST /auctions/:id/bid
GET /auctions/:id/bids
```

#### Лотереи

```
GET /lotteries?status=active
GET /lotteries/:id
POST /lotteries/:id/tickets
GET /lotteries/:id/my-tickets
```

### Модели данных (DTO примеры)

#### AuctionDto

```kotlin
@Serializable
data class AuctionDto(
    val id: String,
    val item: ItemDto,
    val startPrice: Double,
    val currentPrice: Double,
    val startTime: String, // ISO 8601
    val endTime: String,
    val status: String, // "active", "ended", "cancelled"
    val bidsCount: Int,
    val seller: UserDto
)
```

#### LotteryDto

```kotlin
@Serializable
data class LotteryDto(
    val id: String,
    val item: ItemDto,
    val ticketPrice: Double,
    val maxTickets: Int,
    val ticketsSold: Int,
    val drawTime: String,
    val status: String, // "active", "drawn", "cancelled"
    val serverSeedHash: String
)
```

### Mock данные для разработки

Создать MockApiService с тестовыми данными для разработки без backend:

- 20 тестовых аукционов
- 10 тестовых лотерей
- Имитация задержки сети (500-1000ms)

## Модели данных (Domain)

### Auction

```kotlin
data class Auction(
    val id: String,
    val item: Item,
    val startPrice: Money,
    val currentPrice: Money,
    val startTime: Instant,
    val endTime: Instant,
    val status: AuctionStatus,
    val bidsCount: Int,
    val seller: User,
    val timeRemaining: Duration // вычисляемое поле
)

enum class AuctionStatus {
    ACTIVE, ENDED, CANCELLED
}
```

### Lottery

```kotlin
data class Lottery(
    val id: String,
    val item: Item,
    val ticketPrice: Money,
    val maxTickets: Int,
    val ticketsSold: Int,
    val drawTime: Instant,
    val status: LotteryStatus,
    val serverSeedHash: String,
    val availableTickets: Int // вычисляемое поле
)

enum class LotteryStatus {
    ACTIVE, DRAWN, CANCELLED
}
```

### Item

```kotlin
data class Item(
    val id: String,
    val title: String,
    val description: String,
    val category: Category,
    val condition: Condition,
    val photos: List<String>, // URLs
    val verificationStatus: VerificationStatus
)

enum class Category {
    SNEAKERS, CLOTHING, TOYS, POSTERS, OTHER
}

enum class Condition {
    NEW, LIKE_NEW, GOOD, FAIR
}

enum class VerificationStatus {
    VERIFIED_A, VERIFIED_B, PENDING, NOT_VERIFIED
}
```

## Use Cases (примеры)

### GetAuctionsUseCase

```kotlin
class GetAuctionsUseCase @Inject constructor(
    private val repository: AuctionRepository
) {
    operator fun invoke(
        category: Category? = null,
        sortBy: SortOption = SortOption.ENDING_SOON
    ): Flow<Result<List<Auction>>> {
        return repository.getAuctions(category, sortBy)
    }
}
```

### PlaceBidUseCase

```kotlin
class PlaceBidUseCase @Inject constructor(
    private val repository: AuctionRepository
) {
    suspend operator fun invoke(
        auctionId: String,
        amount: Money
    ): Result<Bid> {
        // Валидация
        if (amount.value <= 0) {
            return Result.failure(InvalidBidException("Сумма должна быть больше 0"))
        }
        
        return repository.placeBid(auctionId, amount)
    }
}
```

## ViewModel (примеры)

### AuctionListViewModel

```kotlin
@HiltViewModel
class AuctionListViewModel @Inject constructor(
    private val getAuctionsUseCase: GetAuctionsUseCase
) : ViewModel() {
    
    private val _uiState = MutableStateFlow<AuctionListUiState>(AuctionListUiState.Loading)
    val uiState: StateFlow<AuctionListUiState> = _uiState.asStateFlow()
    
    init {
        loadAuctions()
    }
    
    fun loadAuctions(category: Category? = null) {
        viewModelScope.launch {
            getAuctionsUseCase(category)
                .collect { result ->
                    _uiState.value = when {
                        result.isSuccess -> {
                            val auctions = result.getOrNull() ?: emptyList()
                            if (auctions.isEmpty()) {
                                AuctionListUiState.Empty
                            } else {
                                AuctionListUiState.Success(auctions)
                            }
                        }
                        result.isFailure -> {
                            AuctionListUiState.Error(
                                result.exceptionOrNull()?.message ?: "Неизвестная ошибка"
                            )
                        }
                        else -> AuctionListUiState.Loading
                    }
                }
        }
    }
    
    fun retry() {
        loadAuctions()
    }
}

sealed class AuctionListUiState {
    object Loading : AuctionListUiState()
    data class Success(val auctions: List<Auction>) : AuctionListUiState()
    data class Error(val message: String) : AuctionListUiState()
    object Empty : AuctionListUiState()
}
```

## UI компоненты (XML + Fragments)

### AuctionListFragment

```kotlin
class AuctionListFragment : Fragment() {
    
    private var _binding: FragmentAuctionListBinding? = null
    private val binding get() = _binding!!
    
    private val viewModel: AuctionListViewModel by viewModels()
    private lateinit var auctionAdapter: AuctionAdapter
    
    override fun onCreateView(
        inflater: LayoutInflater,
        container: ViewGroup?,
        savedInstanceState: Bundle?
    ): View {
        _binding = FragmentAuctionListBinding.inflate(inflater, container, false)
        return binding.root
    }
    
    override fun onViewCreated(view: View, savedInstanceState: Bundle?) {
        super.onViewCreated(view, savedInstanceState)
        
        setupRecyclerView()
        setupSwipeRefresh()
        observeViewModel()
    }
    
    private fun setupRecyclerView() {
        auctionAdapter = AuctionAdapter { auction ->
            // Навигация к детальному экрану
            findNavController().navigate(
                AuctionListFragmentDirections.actionAuctionListToAuctionDetail(auction.id)
            )
        }
        
        binding.recyclerViewAuctions.apply {
            adapter = auctionAdapter
            layoutManager = LinearLayoutManager(context)
            addItemDecoration(DividerItemDecoration(context, DividerItemDecoration.VERTICAL))
        }
    }
    
    private fun setupSwipeRefresh() {
        binding.swipeRefresh.setOnRefreshListener {
            viewModel.loadAuctions()
        }
    }
    
    private fun observeViewModel() {
        viewLifecycleOwner.lifecycleScope.launch {
            viewModel.uiState.collect { state ->
                when (state) {
                    is AuctionListUiState.Loading -> {
                        binding.progressBar.visibility = View.VISIBLE
                        binding.recyclerViewAuctions.visibility = View.GONE
                        binding.textViewError.visibility = View.GONE
                        binding.textViewEmpty.visibility = View.GONE
                    }
                    is AuctionListUiState.Success -> {
                        binding.progressBar.visibility = View.GONE
                        binding.recyclerViewAuctions.visibility = View.VISIBLE
                        binding.textViewError.visibility = View.GONE
                        binding.textViewEmpty.visibility = View.GONE
                        binding.swipeRefresh.isRefreshing = false
                        
                        auctionAdapter.submitList(state.auctions)
                    }
                    is AuctionListUiState.Error -> {
                        binding.progressBar.visibility = View.GONE
                        binding.recyclerViewAuctions.visibility = View.GONE
                        binding.textViewError.visibility = View.VISIBLE
                        binding.textViewEmpty.visibility = View.GONE
                        binding.swipeRefresh.isRefreshing = false
                        
                        binding.textViewError.text = state.message
                        binding.buttonRetry.setOnClickListener {
                            viewModel.retry()
                        }
                    }
                    is AuctionListUiState.Empty -> {
                        binding.progressBar.visibility = View.GONE
                        binding.recyclerViewAuctions.visibility = View.GONE
                        binding.textViewError.visibility = View.GONE
                        binding.textViewEmpty.visibility = View.VISIBLE
                        binding.swipeRefresh.isRefreshing = false
                    }
                }
            }
        }
    }
    
    override fun onDestroyView() {
        super.onDestroyView()
        _binding = null
    }
}
```

### AuctionAdapter

```kotlin
class AuctionAdapter(
    private val onItemClick: (Auction) -> Unit
) : ListAdapter<Auction, AuctionAdapter.AuctionViewHolder>(AuctionDiffCallback()) {
    
    override fun onCreateViewHolder(parent: ViewGroup, viewType: Int): AuctionViewHolder {
        val binding = ItemAuctionBinding.inflate(
            LayoutInflater.from(parent.context),
            parent,
            false
        )
        return AuctionViewHolder(binding)
    }
    
    override fun onBindViewHolder(holder: AuctionViewHolder, position: Int) {
        holder.bind(getItem(position))
    }
    
    inner class AuctionViewHolder(
        private val binding: ItemAuctionBinding
    ) : RecyclerView.ViewHolder(binding.root) {
        
        fun bind(auction: Auction) {
            binding.apply {
                // Загрузка изображения
                Glide.with(itemView.context)
                    .load(auction.item.photos.firstOrNull())
                    .placeholder(R.drawable.placeholder_image)
                    .error(R.drawable.error_image)
                    .into(imageViewAuctionPhoto)
                
                textViewTitle.text = auction.item.title
                textViewCurrentPrice.text = auction.currentPrice.formatted()
                textViewBidsCount.text = "${auction.bidsCount} ставок"
                
                // Таймер
                startCountdownTimer(auction.endTime)
                
                // Клик по элементу
                root.setOnClickListener {
                    onItemClick(auction)
                }
            }
        }
        
        private fun startCountdownTimer(endTime: Instant) {
            val timer = object : CountDownTimer(
                endTime.toEpochMilli() - System.currentTimeMillis(),
                1000
            ) {
                override fun onTick(millisUntilFinished: Long) {
                    val duration = Duration.ofMillis(millisUntilFinished)
                    binding.textViewTimeRemaining.text = duration.formatted()
                }
                
                override fun onFinish() {
                    binding.textViewTimeRemaining.text = "Завершён"
                }
            }
            timer.start()
        }
    }
    
    class AuctionDiffCallback : DiffUtil.ItemCallback<Auction>() {
        override fun areItemsTheSame(oldItem: Auction, newItem: Auction): Boolean {
            return oldItem.id == newItem.id
        }
        
        override fun areContentsTheSame(oldItem: Auction, newItem: Auction): Boolean {
            return oldItem == newItem
        }
    }
}
```

### fragment_auction_list.xml

```xml
<?xml version="1.0" encoding="utf-8"?>
<androidx.swiperefreshlayout.widget.SwipeRefreshLayout
    xmlns:android="http://schemas.android.com/apk/res/android"
    xmlns:app="http://schemas.android.com/apk/res-auto"
    android:id="@+id/swipeRefresh"
    android:layout_width="match_parent"
    android:layout_height="match_parent">

    <androidx.constraintlayout.widget.ConstraintLayout
        android:layout_width="match_parent"
        android:layout_height="match_parent">

        <androidx.recyclerview.widget.RecyclerView
            android:id="@+id/recyclerViewAuctions"
            android:layout_width="match_parent"
            android:layout_height="0dp"
            android:padding="8dp"
            app:layout_constraintTop_toTopOf="parent"
            app:layout_constraintBottom_toBottomOf="parent"
            app:layout_constraintStart_toStartOf="parent"
            app:layout_constraintEnd_toEndOf="parent" />

        <ProgressBar
            android:id="@+id/progressBar"
            android:layout_width="wrap_content"
            android:layout_height="wrap_content"
            android:visibility="gone"
            app:layout_constraintTop_toTopOf="parent"
            app:layout_constraintBottom_toBottomOf="parent"
            app:layout_constraintStart_toStartOf="parent"
            app:layout_constraintEnd_toEndOf="parent" />

        <TextView
            android:id="@+id/textViewEmpty"
            android:layout_width="wrap_content"
            android:layout_height="wrap_content"
            android:text="Список аукционов пуст"
            android:textSize="16sp"
            android:visibility="gone"
            app:layout_constraintTop_toTopOf="parent"
            app:layout_constraintBottom_toBottomOf="parent"
            app:layout_constraintStart_toStartOf="parent"
            app:layout_constraintEnd_toEndOf="parent" />

        <LinearLayout
            android:id="@+id/layoutError"
            android:layout_width="wrap_content"
            android:layout_height="wrap_content"
            android:orientation="vertical"
            android:gravity="center"
            android:visibility="gone"
            app:layout_constraintTop_toTopOf="parent"
            app:layout_constraintBottom_toBottomOf="parent"
            app:layout_constraintStart_toStartOf="parent"
            app:layout_constraintEnd_toEndOf="parent">

            <TextView
                android:id="@+id/textViewError"
                android:layout_width="wrap_content"
                android:layout_height="wrap_content"
                android:text="Произошла ошибка"
                android:textSize="16sp"
                android:gravity="center" />

            <Button
                android:id="@+id/buttonRetry"
                android:layout_width="wrap_content"
                android:layout_height="wrap_content"
                android:text="Повторить"
                android:layout_marginTop="16dp" />

        </LinearLayout>

    </androidx.constraintlayout.widget.ConstraintLayout>

</androidx.swiperefreshlayout.widget.SwipeRefreshLayout>
```

### item_auction.xml

```xml
<?xml version="1.0" encoding="utf-8"?>
<com.google.android.material.card.MaterialCardView
    xmlns:android="http://schemas.android.com/apk/res/android"
    xmlns:app="http://schemas.android.com/apk/res-auto"
    android:layout_width="match_parent"
    android:layout_height="wrap_content"
    android:layout_margin="4dp"
    app:cardCornerRadius="8dp"
    app:cardElevation="4dp">

    <androidx.constraintlayout.widget.ConstraintLayout
        android:layout_width="match_parent"
        android:layout_height="wrap_content"
        android:padding="16dp">

        <ImageView
            android:id="@+id/imageViewAuctionPhoto"
            android:layout_width="0dp"
            android:layout_height="200dp"
            android:scaleType="centerCrop"
            android:background="@color/placeholder_background"
            app:layout_constraintTop_toTopOf="parent"
            app:layout_constraintStart_toStartOf="parent"
            app:layout_constraintEnd_toEndOf="parent" />

        <TextView
            android:id="@+id/textViewTitle"
            android:layout_width="0dp"
            android:layout_height="wrap_content"
            android:layout_marginTop="12dp"
            android:text="Название товара"
            android:textSize="16sp"
            android:textStyle="bold"
            android:maxLines="2"
            android:ellipsize="end"
            app:layout_constraintTop_toBottomOf="@id/imageViewAuctionPhoto"
            app:layout_constraintStart_toStartOf="parent"
            app:layout_constraintEnd_toEndOf="parent" />

        <LinearLayout
            android:id="@+id/layoutPrice"
            android:layout_width="0dp"
            android:layout_height="wrap_content"
            android:layout_marginTop="8dp"
            android:orientation="horizontal"
            android:gravity="center_vertical"
            app:layout_constraintTop_toBottomOf="@id/textViewTitle"
            app:layout_constraintStart_toStartOf="parent"
            app:layout_constraintEnd_toEndOf="parent">

            <TextView
                android:layout_width="0dp"
                android:layout_height="wrap_content"
                android:layout_weight="1"
                android:text="Текущая цена:"
                android:textSize="14sp"
                android:textColor="@color/text_secondary" />

            <TextView
                android:id="@+id/textViewCurrentPrice"
                android:layout_width="wrap_content"
                android:layout_height="wrap_content"
                android:text="₽ 15,000"
                android:textSize="18sp"
                android:textStyle="bold"
                android:textColor="@color/primary" />

        </LinearLayout>

        <LinearLayout
            android:id="@+id/layoutTimer"
            android:layout_width="0dp"
            android:layout_height="wrap_content"
            android:layout_marginTop="4dp"
            android:orientation="horizontal"
            android:gravity="center_vertical"
            app:layout_constraintTop_toBottomOf="@id/layoutPrice"
            app:layout_constraintStart_toStartOf="parent"
            app:layout_constraintEnd_toEndOf="parent">

            <ImageView
                android:layout_width="16dp"
                android:layout_height="16dp"
                android:src="@drawable/ic_timer"
                android:tint="@color/error" />

            <TextView
                android:id="@+id/textViewTimeRemaining"
                android:layout_width="wrap_content"
                android:layout_height="wrap_content"
                android:layout_marginStart="4dp"
                android:text="2ч 34м"
                android:textSize="14sp"
                android:textColor="@color/error" />

        </LinearLayout>

        <TextView
            android:id="@+id/textViewBidsCount"
            android:layout_width="wrap_content"
            android:layout_height="wrap_content"
            android:layout_marginTop="4dp"
            android:text="15 ставок"
            android:textSize="12sp"
            android:textColor="@color/text_secondary"
            app:layout_constraintTop_toBottomOf="@id/layoutTimer"
            app:layout_constraintStart_toStartOf="parent" />

    </androidx.constraintlayout.widget.ConstraintLayout>

</com.google.android.material.card.MaterialCardView>
```

## Навигация

### Navigation Graph (nav_graph.xml)

```xml
<?xml version="1.0" encoding="utf-8"?>
<navigation xmlns:android="http://schemas.android.com/apk/res/android"
    xmlns:app="http://schemas.android.com/apk/res-auto"
    xmlns:tools="http://schemas.android.com/tools"
    android:id="@+id/nav_graph"
    app:startDestination="@id/auctionListFragment">

    <fragment
        android:id="@+id/auctionListFragment"
        android:name="com.example.raremerch.presentation.screens.auctions.AuctionListFragment"
        android:label="Аукционы"
        tools:layout="@layout/fragment_auction_list">

        <action
            android:id="@+id/action_auctionList_to_auctionDetail"
            app:destination="@id/auctionDetailFragment" />

    </fragment>

    <fragment
        android:id="@+id/auctionDetailFragment"
        android:name="com.example.raremerch.presentation.screens.auctions.AuctionDetailFragment"
        android:label="Детали аукциона"
        tools:layout="@layout/fragment_auction_detail">

        <argument
            android:name="auctionId"
            app:argType="string" />

    </fragment>

    <fragment
        android:id="@+id/lotteryListFragment"
        android:name="com.example.raremerch.presentation.screens.lotteries.LotteryListFragment"
        android:label="Лотереи"
        tools:layout="@layout/fragment_lottery_list">

        <action
            android:id="@+id/action_lotteryList_to_lotteryDetail"
            app:destination="@id/lotteryDetailFragment" />

    </fragment>

    <fragment
        android:id="@+id/lotteryDetailFragment"
        android:name="com.example.raremerch.presentation.screens.lotteries.LotteryDetailFragment"
        android:label="Детали лотереи"
        tools:layout="@layout/fragment_lottery_detail">

        <argument
            android:name="lotteryId"
            app:argType="string" />

    </fragment>

    <fragment
        android:id="@+id/profileFragment"
        android:name="com.example.raremerch.presentation.screens.profile.ProfileFragment"
        android:label="Профиль"
        tools:layout="@layout/fragment_profile" />

</navigation>
```

### MainActivity с Bottom Navigation

```kotlin
class MainActivity : AppCompatActivity() {
    
    private lateinit var binding: ActivityMainBinding
    private lateinit var navController: NavController
    
    override fun onCreate(savedInstanceState: Bundle?) {
        super.onCreate(savedInstanceState)
        binding = ActivityMainBinding.inflate(layoutInflater)
        setContentView(binding.root)
        
        setupNavigation()
    }
    
    private fun setupNavigation() {
        navController = findNavController(R.id.nav_host_fragment)
        
        binding.bottomNavigation.setupWithNavController(navController)
        
        // Обработка выбора элементов bottom navigation
        binding.bottomNavigation.setOnItemSelectedListener { item ->
            when (item.itemId) {
                R.id.nav_auctions -> {
                    navController.navigate(R.id.auctionListFragment)
                    true
                }
                R.id.nav_lotteries -> {
                    navController.navigate(R.id.lotteryListFragment)
                    true
                }
                R.id.nav_profile -> {
                    navController.navigate(R.id.profileFragment)
                    true
                }
                else -> false
            }
        }
    }
}
```

### activity_main.xml

```xml
<?xml version="1.0" encoding="utf-8"?>
<androidx.constraintlayout.widget.ConstraintLayout
    xmlns:android="http://schemas.android.com/apk/res/android"
    xmlns:app="http://schemas.android.com/apk/res-auto"
    android:layout_width="match_parent"
    android:layout_height="match_parent">

    <androidx.fragment.app.FragmentContainerView
        android:id="@+id/nav_host_fragment"
        android:name="androidx.navigation.fragment.NavHostFragment"
        android:layout_width="0dp"
        android:layout_height="0dp"
        app:defaultNavHost="true"
        app:layout_constraintTop_toTopOf="parent"
        app:layout_constraintBottom_toTopOf="@id/bottomNavigation"
        app:layout_constraintStart_toStartOf="parent"
        app:layout_constraintEnd_toEndOf="parent"
        app:navGraph="@navigation/nav_graph" />

    <com.google.android.material.bottomnavigation.BottomNavigationView
        android:id="@+id/bottomNavigation"
        android:layout_width="0dp"
        android:layout_height="wrap_content"
        android:background="?attr/colorSurface"
        app:layout_constraintBottom_toBottomOf="parent"
        app:layout_constraintStart_toStartOf="parent"
        app:layout_constraintEnd_toEndOf="parent"
        app:menu="@menu/bottom_nav_menu" />

</androidx.constraintlayout.widget.ConstraintLayout>
```

### bottom_nav_menu.xml

```xml
<?xml version="1.0" encoding="utf-8"?>
<menu xmlns:android="http://schemas.android.com/apk/res/android">
    
    <item
        android:id="@+id/nav_auctions"
        android:icon="@drawable/ic_auction"
        android:title="Аукционы" />
    
    <item
        android:id="@+id/nav_lotteries"
        android:icon="@drawable/ic_lottery"
        android:title="Лотереи" />
    
    <item
        android:id="@+id/nav_profile"
        android:icon="@drawable/ic_profile"
        android:title="Профиль" />
    
</menu>
```

## Dependency Injection (Hilt)

### AppModule

```kotlin
@Module
@InstallIn(SingletonComponent::class)
object AppModule {
    
    @Provides
    @Singleton
    fun provideContext(@ApplicationContext context: Context): Context = context
}
```

### NetworkModule

```kotlin
@Module
@InstallIn(SingletonComponent::class)
object NetworkModule {
    
    @Provides
    @Singleton
    fun provideOkHttpClient(
        authInterceptor: AuthInterceptor
    ): OkHttpClient {
        return OkHttpClient.Builder()
            .addInterceptor(authInterceptor)
            .addInterceptor(HttpLoggingInterceptor().apply {
                level = HttpLoggingInterceptor.Level.BODY
            })
            .connectTimeout(30, TimeUnit.SECONDS)
            .readTimeout(30, TimeUnit.SECONDS)
            .build()
    }
    
    @Provides
    @Singleton
    fun provideRetrofit(okHttpClient: OkHttpClient): Retrofit {
        return Retrofit.Builder()
            .baseUrl("https://api.raremerch.com/api/v1/")
            .client(okHttpClient)
            .addConverterFactory(Json.asConverterFactory("application/json".toMediaType()))
            .build()
    }
    
    @Provides
    @Singleton
    fun provideAuctionApi(retrofit: Retrofit): AuctionApi {
        return retrofit.create(AuctionApi::class.java)
    }
    
    @Provides
    @Singleton
    fun provideLotteryApi(retrofit: Retrofit): LotteryApi {
        return retrofit.create(LotteryApi::class.java)
    }
}
```

## Локальное хранилище (Room)

### AppDatabase

```kotlin
@Database(
    entities = [
        AuctionEntity::class,
        LotteryEntity::class,
        ItemEntity::class
    ],
    version = 1,
    exportSchema = false
)
abstract class AppDatabase : RoomDatabase() {
    abstract fun auctionDao(): AuctionDao
    abstract fun lotteryDao(): LotteryDao
    abstract fun itemDao(): ItemDao
}
```

### AuctionDao

```kotlin
@Dao
interface AuctionDao {
    @Query("SELECT * FROM auctions WHERE status = 'ACTIVE' ORDER BY endTime ASC")
    fun getActiveAuctions(): Flow<List<AuctionEntity>>
    
    @Query("SELECT * FROM auctions WHERE id = :id")
    suspend fun getAuctionById(id: String): AuctionEntity?
    
    @Insert(onConflict = OnConflictStrategy.REPLACE)
    suspend fun insertAuctions(auctions: List<AuctionEntity>)
    
    @Query("DELETE FROM auctions WHERE endTime < :timestamp")
    suspend fun deleteExpiredAuctions(timestamp: Long)
}
```

## Тестирование

### Unit тесты (примеры)

#### GetAuctionsUseCaseTest

```kotlin
class GetAuctionsUseCaseTest {
    
    private lateinit var repository: AuctionRepository
    private lateinit var useCase: GetAuctionsUseCase
    
    @Before
    fun setup() {
        repository = mockk()
        useCase = GetAuctionsUseCase(repository)
    }
    
    @Test
    fun `invoke returns auctions from repository`() = runTest {
        // Given
        val expectedAuctions = listOf(
            createTestAuction(id = "1"),
            createTestAuction(id = "2")
        )
        coEvery { repository.getAuctions(any(), any()) } returns flowOf(Result.success(expectedAuctions))
        
        // When
        val result = useCase().first()
        
        // Then
        assertTrue(result.isSuccess)
        assertEquals(2, result.getOrNull()?.size)
    }
}
```

#### AuctionListViewModelTest

```kotlin
class AuctionListViewModelTest {
    
    @get:Rule
    val mainDispatcherRule = MainDispatcherRule()
    
    private lateinit var getAuctionsUseCase: GetAuctionsUseCase
    private lateinit var viewModel: AuctionListViewModel
    
    @Before
    fun setup() {
        getAuctionsUseCase = mockk()
    }
    
    @Test
    fun `initial state is Loading`() {
        // Given
        coEvery { getAuctionsUseCase(any()) } returns flowOf(Result.success(emptyList()))
        
        // When
        viewModel = AuctionListViewModel(getAuctionsUseCase)
        
        // Then
        assertTrue(viewModel.uiState.value is AuctionListUiState.Loading)
    }
    
    @Test
    fun `loadAuctions updates state to Success`() = runTest {
        // Given
        val auctions = listOf(createTestAuction())
        coEvery { getAuctionsUseCase(any()) } returns flowOf(Result.success(auctions))
        
        // When
        viewModel = AuctionListViewModel(getAuctionsUseCase)
        advanceUntilIdle()
        
        // Then
        val state = viewModel.uiState.value
        assertTrue(state is AuctionListUiState.Success)
        assertEquals(1, (state as AuctionListUiState.Success).auctions.size)
    }
}
```

## Конфигурация проекта

### build.gradle.kts (app)

```kotlin
plugins {
    id("com.android.application")
    id("org.jetbrains.kotlin.android")
    id("com.google.dagger.hilt.android")
    id("org.jetbrains.kotlin.plugin.serialization")
    kotlin("kapt")
}

android {
    namespace = "com.example.raremerch"
    compileSdk = 34
    
    defaultConfig {
        applicationId = "com.example.raremerch"
        minSdk = 24
        targetSdk = 34
        versionCode = 1
        versionName = "1.0.0"
        
        testInstrumentationRunner = "androidx.test.runner.AndroidJUnitRunner"
    }
    
    buildFeatures {
        viewBinding = true
    }
    
    buildTypes {
        debug {
            buildConfigField("String", "API_BASE_URL", "\"https://api.raremerch.com/api/v1/\"")
        }
        release {
            isMinifyEnabled = true
            proguardFiles(getDefaultProguardFile("proguard-android-optimize.txt"), "proguard-rules.pro")
            buildConfigField("String", "API_BASE_URL", "\"https://api.raremerch.com/api/v1/\"")
        }
    }
}

dependencies {
    // Core
    implementation("androidx.core:core-ktx:1.12.0")
    implementation("androidx.lifecycle:lifecycle-runtime-ktx:2.6.2")
    implementation("androidx.activity:activity-ktx:1.8.0")
    implementation("androidx.fragment:fragment-ktx:1.6.1")
    
    // UI
    implementation("androidx.appcompat:appcompat:1.6.1")
    implementation("com.google.android.material:material:1.9.0")
    implementation("androidx.constraintlayout:constraintlayout:2.1.4")
    implementation("androidx.recyclerview:recyclerview:1.3.1")
    implementation("androidx.swiperefreshlayout:swiperefreshlayout:1.1.0")
    implementation("androidx.viewpager2:viewpager2:1.0.0")
    
    // Navigation
    implementation("androidx.navigation:navigation-fragment-ktx:2.7.5")
    implementation("androidx.navigation:navigation-ui-ktx:2.7.5")
    
    // Hilt
    implementation("com.google.dagger:hilt-android:2.48")
    kapt("com.google.dagger:hilt-compiler:2.48")
    
    // Network
    implementation("com.squareup.retrofit2:retrofit:2.9.0")
    implementation("com.squareup.okhttp3:okhttp:4.12.0")
    implementation("com.squareup.okhttp3:logging-interceptor:4.12.0")
    implementation("org.jetbrains.kotlinx:kotlinx-serialization-json:1.6.0")
    implementation("com.jakewharton.retrofit:retrofit2-kotlinx-serialization-converter:1.0.0")
    
    // Room
    implementation("androidx.room:room-runtime:2.6.0")
    implementation("androidx.room:room-ktx:2.6.0")
    kapt("androidx.room:room-compiler:2.6.0")
    
    // Glide (изображения)
    implementation("com.github.bumptech.glide:glide:4.16.0")
    kapt("com.github.bumptech.glide:compiler:4.16.0")
    
    // Kotlinx DateTime
    implementation("org.jetbrains.kotlinx:kotlinx-datetime:0.4.1")
    
    // Logging
    implementation("com.jakewharton.timber:timber:5.0.1")
    
    // Testing
    testImplementation("junit:junit:4.13.2")
    testImplementation("io.mockk:mockk:1.13.8")
    testImplementation("org.jetbrains.kotlinx:kotlinx-coroutines-test:1.7.3")
    testImplementation("app.cash.turbine:turbine:1.0.0")
    androidTestImplementation("androidx.test.ext:junit:1.1.5")
    androidTestImplementation("androidx.test.espresso:espresso-core:3.5.1")
}
```

## Этапы разработки (для начинающих)

### Этап 1: Настройка проекта (1-2 дня)

1. Создать новый Android проект в Android Studio
2. Настроить Gradle зависимости
3. Настроить Hilt
4. Создать базовую структуру пакетов
5. Настроить ViewBinding

### Этап 2: Слой данных (3-4 дня)

1. Создать DTO модели
2. Реализовать Retrofit API интерфейсы
3. Создать Mock API для тестирования
4. Настроить Room базу данных
5. Реализовать репозитории

### Этап 3: Доменный слой (2-3 дня)

1. Создать доменные модели
2. Реализовать маппинг DTO → Domain
3. Создать Use Cases для аукционов
4. Создать Use Cases для лотерей

### Этап 4: UI слой - Аукционы (4-5 дней)

1. Создать AuctionListViewModel
2. Создать AuctionListFragment с XML layout
3. Создать AuctionAdapter для RecyclerView
4. Создать AuctionDetailViewModel
5. Создать AuctionDetailFragment
6. Реализовать функционал ставок

### Этап 5: UI слой - Лотереи (3-4 дня)

1. Создать LotteryListViewModel
2. Создать LotteryListFragment
3. Создать LotteryAdapter
4. Создать LotteryDetailViewModel
5. Создать LotteryDetailFragment
6. Реализовать функционал покупки билетов

### Этап 6: Аутентификация и профиль (2-3 дня)

1. Создать LoginViewModel и LoginFragment
2. Реализовать хранение токена
3. Создать AuthInterceptor для Retrofit
4. Создать ProfileFragment

### Этап 7: Навигация и интеграция (2 дня)

1. Настроить Navigation Graph
2. Создать Bottom Navigation
3. Интегрировать все экраны

### Этап 8: Полировка и тестирование (3-4 дня)

1. Добавить обработку ошибок
2. Реализовать offline-режим
3. Написать Unit тесты
4. Протестировать на разных устройствах
5. Оптимизация производительности

**Общая оценка времени: 20-27 дней (3-4 недели)**

## Полезные ресурсы для начинающих

### Официальная документация

- [Android Developers](https://developer.android.com/)
- [ViewBinding](https://developer.android.com/topic/libraries/view-binding)
- [Navigation Component](https://developer.android.com/guide/navigation)
- [Kotlin Coroutines](https://kotlinlang.org/docs/coroutines-overview.html)

### Курсы и туториалы

- Android Basics in Kotlin (Google)
- Philipp Lackner YouTube канал
- Coding in Flow YouTube канал

### Инструменты

- Android Studio (последняя стабильная версия)
- Postman (для тестирования API)
- DB Browser for SQLite (для просмотра Room БД)

## Критерии готовности MVP

- ✅ Пользователь может войти в приложение
- ✅ Отображается список активных аукционов
- ✅ Можно просмотреть детали аукциона
- ✅ Можно сделать ставку на аукцион
- ✅ Отображается список лотерей
- ✅ Можно просмотреть детали лотереи
- ✅ Можно купить билеты на лотерею
- ✅ Работает offline-режим с кэшированием
- ✅ Приложение не крашится при ошибках сети
- ✅ UI соответствует Material Design 3
- ✅ Написаны базовые Unit тесты

## Возможные проблемы и решения

### Проблема 1: Сложность Clean Architecture для новичков

**Решение**: Начать с упрощённой версии (без Use Cases), добавить их позже

### Проблема 2: Работа с RecyclerView и адаптерами

**Решение**: Использовать ListAdapter с DiffUtil, изучить ViewHolder паттерн

### Проблема 3: Асинхронность и Coroutines

**Решение**: Изучить базовые концепции: launch, async, Flow перед началом

### Проблема 4: Отсутствие реального backend

**Решение**: Использовать Mock API с задержками для имитации реальных условий

### Проблема 5: Управление жизненным циклом Fragment

**Решение**: Использовать viewLifecycleOwner, правильно обрабатывать onDestroyView

### Проблема 6: Memory leaks в RecyclerView

**Решение**: Правильно очищать адаптеры, использовать WeakReference где нужно

### To-dos

- [ ] Создать файл с ТЗ для мобильного приложения на Kotlin
- [ ] Добавить эмодзи для файла ТЗ в Obsidian конфигурацию